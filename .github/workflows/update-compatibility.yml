name: Update Readme Compatibility

on:
  push:
    paths:
      - 'compatibility-versions.json'
    branches:
      - 'master'

jobs:
  updateCompatibilityTable:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
    - uses: sblecon/auto-filling-by-the-code@master
      with:
        version_file_path: 'compatibility-versions.json'
        readme_path: 'README.md'
        section_title: '# Compatibility table'
    - name: Create Pull Request
      id: cpr
      uses: peter-evans/create-pull-request@v2
      with:
        token: ${{ GH_TOKEN }}
        commit-message: Update README.md Compatibility table
        committer: GitHub Action <action@github.com>
        author: GitHub Action <action@github.com>
        title: '[CompatibilityTable] Update README.md'
        body: |
          New Compatibility table update
          - Readme.md section '# Compatibility table'
          - Auto-generated by [auto-filling-by-the-code][1]
          - Auto-generated by [create-pull-request][2]

          [1]: https://github.com/sblecon/auto-filling-by-the-code
          [2]: https://github.com/peter-evans/create-pull-request
        labels: compatibility, automated
        assignees: aure-olivier
        reviewers: aure-olivier
        team-reviewers: owners, maintainers
        milestone: 1
        branch: compatibility-table
    - name: Check outputs
      run: |
        echo "Pull Request Number - ${{ env.PULL_REQUEST_NUMBER }}"
        echo "Pull Request Number - ${{ steps.cpr.outputs.pr_number }}"